@{
    ViewBag.Title = "项目信息管理";
    Layout = "~/Views/Shared/_LayoutIndex.cshtml";
}

<script type="text/javascript">
    $(document).ready(function () {
        GetTree();
        GetGrid();
    });

    //加载左边树
    //注意 FolderId 默认等于1 这样就可以加载一级目录下的子节点文件夹
    var ItemId = 2;
    var TreeId = "59";
    var data_id = "";
    //ItemId = GetQuery("ItemID"), IsPublic = "1";
    function GetTree() {
        var itemtree = {
            onnodeclick: function (node) {
                TreeId = node.id;
                TreeName = node.text;
                $("#CenterTitle").html(" - " + TreeName);
                if (TreeName == "工程属性") {
                    //var leftHeight=parseInt(document.getElementById("left").style.clientHeight);
                    document.getElementById("table_project").style.display = "block";
                    document.getElementById("div_project_photo").style.display = "none";
                    document.getElementById("div_projcet_logo").style.display = "none";
                } else if (TreeName == "系统Logo") {
                    document.getElementById("table_project").style.display = "none";
                    document.getElementById("div_project_photo").style.display = "none";
                    document.getElementById("div_projcet_logo").style.display = "block";
                } else {
                    document.getElementById("table_project").style.display = "none";
                    document.getElementById("div_project_photo").style.display = "block";
                    document.getElementById("div_projcet_logo").style.display = "none";
                }

            },
            url: "@Url.Content("~/SteelMember/ProjectInfo/TreeJson")?ItemId=" + ItemId
        };
        $("#ItemsTree").treeview(itemtree);
    };


    ////表格文件夹点击事件
    //function GridFolderEvent(TreeId) {
    //    AjaxJson("/SteelMember/ProjectInfo/GetItemInfo", { KeyValue: TreeId }, function (data) {
    //        SetWebControls(data);
    //        data_id = data.ProjectId;
    //        var filename="", filename1="";

    //        filename = data.ProjectLogo;
    //        filename = filename.substring(0, filename.lastIndexOf('.'));//获取文件名称，去除后缀名
    //        filename = "../../Resource/Document/NetworkDisk/System/Project/" + filename + "/" + data.ProjectLogo;
    //        document.getElementById("project_logo").src = filename;

    //        filename1 = data.ProjectBackground;
    //        filename1 = filename1.substring(0, filename1.lastIndexOf('.'));//获取文件名称，去除后缀名
    //        filename1 = "../../Resource/Document/NetworkDisk/System/Project/" + filename1 + "/" + data.ProjectBackground;
    //        document.getElementById("project_background").src = filename1;
    //    });
    //}

    //加载表格
    function GetGrid() {
        AjaxJson("/SteelMember/ProjectInfo/GetItemInfo", { KeyValue: TreeId }, function (data) {
            SetWebControls(data);
            data_id = data.ProjectId;
            var filename = "", filename1 = "";

            filename = data.ProjectLogo;
            filename = filename.substring(0, filename.lastIndexOf('.'));//获取文件名称，去除后缀名
            filename = "../../Resource/Document/NetworkDisk/System/Project/" + filename + "/" + data.ProjectLogo;
            document.getElementById("project_logo").src = filename;

            filename1 = data.ProjectBackground;
            filename1 = filename1.substring(0, filename1.lastIndexOf('.'));//获取文件名称，去除后缀名
            filename1 = "../../Resource/Document/NetworkDisk/System/Project/" + filename1 + "/" + data.ProjectBackground;
            document.getElementById("project_background").src = filename1;

            document.getElementById("table_project").style.display = "block";
            document.getElementById("div_project_photo").style.display = "none";
            document.getElementById("div_projcet_logo").style.display = "none";
        });
    }

    //按钮刷新表格树
    function btn_reload() {
        GetTree();
        $("#gridTable").trigger("reloadGrid"); //重新载入
    }
    //刷新
    function windowload() {
        $("#gridTable").trigger("reloadGrid"); //重新载入 
    }

    //新增信息
    function btn_add() {
        //var KeyValue = GetJqGridRowValue("#gridTable", "ProjectId");
        if (IsChecked(TreeId)) {
            var url = "/SteelMember/ProjectInfo/Form?TreeId= " + TreeId;
            openDialog(url, "Form", "新增信息", 600, 380, function (iframe) {
                top.frames[iframe].AcceptClick();
            });
        }
        $("#gridTable").trigger("reloadGrid"); //重新载入
    }

    //编辑信息(得到实体)
    function btn_edit() {
        if (data_id != "") {
            var url = "/SteelMember/ProjectInfo/Form?KeyValue= " + data_id;
            openDialog(url, "Form", "编辑信息", 600, 380, function (iframe) {
                top.frames[iframe].AcceptClick();
            });
        } else {
            alertDilog("主键不能为空", 0)
        }
        $("#gridTable").trigger("reloadGrid"); //重新载入
    }

    //删除信息
    function btn_delete() {
        var Prompt = "您确实要删除此文件吗？";
        if (IsDelData(data_id)) {
            delConfirm('/SteelMember/ProjectInfo/DeleteProjectInfo', { KeyValue: data_id }, Prompt);
            $("#gridTable").trigger("reloadGrid"); //重新载入
        }

    }

</script>
<div id="layout" class="layout">
    <!--左边-->
    <div class="layoutPanel layout-west">
        <div class="btnbartitle">
            <div>
                项目信息
            </div>
        </div>
        <div class="ScrollBar" id="ItemsTree"></div>
    </div>
    <!--中间-->
    <div class="layoutPanel layout-center">
        <div class="btnbartitle">
            <div>
                信息表<span id="CenterTitle"></span>
            </div>
        </div>
        <div class="tools_bar" style="border-top: none; margin-bottom: 0px;">
            <div class="PartialButton">
                @Html.Partial("_PartialButton")
            </div>
        </div>
        <div id="table_project">
            <table class="form">
                <tr>
                    <th class="formTitle">
                        项目地址：
                    </th>
                    <td class="formValue" colspan="5">
                        <input id="ProjectAddress" type="text" class="txt" rowspan="4" />
                    </td>
                </tr>
                <tr>
                    <th class="formTitle">
                        业主单位：
                    </th>
                    <td class="formValue">
                        <input id="ConstructionUnit" type="text" class="txt" />
                    </td>
                    <th class="formTitle">
                        负责人：
                    </th>
                    <td class="formValue">
                        <input id="ConstructionPrincipal" type="text" class="txt" />
                    </td>
                    <th class="formTitle">
                        联系电话：
                    </th>
                    <td class="formValue">
                        <input id="ConstructionPrincipalTEL" type="text" class="txt" />
                    </td>
                </tr>

                <tr>
                    <th class="formTitle">
                        设计单位：
                    </th>
                    <td class="formValue">
                        <input id="DesignUnit" type="text" class="txt" />
                    </td>
                    <th class="formTitle">
                        负责人：
                    </th>
                    <td class="formValue">
                        <input id="DesignPrincipal" type="text" class="txt" />
                    </td>
                    <th class="formTitle">
                        联系电话：
                    </th>
                    <td class="formValue">
                        <input id="DesignPrincipalTEL" type="text" class="txt" />
                    </td>
                </tr>
                <tr>
                    <th class="formTitle">监理单位：</th>
                    <td class="formValue">
                        <input id="SupervisionUnit" type="text" class="txt" />
                    </td>
                    <th class="formTitle">
                        负责人：
                    </th>
                    <td class="formValue">
                        <input id="SupervisionPrincipal" type="text" class="txt" />
                    </td>
                    <th class="formTitle">
                        联系电话：
                    </th>
                    <td class="formValue">
                        <input id="SupervisionPrincipalTEL" type="text" class="txt" />
                    </td>
                </tr>
                <tr>
                    <th class="formTitle">总承包商：</th>
                    <td class="formValue">
                        <input id="GeneralContractor" type="text" class="txt" />
                    </td>
                    <th class="formTitle">
                        负责人：
                    </th>
                    <td class="formValue">
                        <input id="GeneralContractorPrincipal" type="text" class="txt" />
                    </td>
                    <th class="formTitle">
                        联系电话：
                    </th>
                    <td class="formValue">
                        <input id="GeneralContractorPrincipalTEL" type="text" class="txt" />
                    </td>
                </tr>
                <tr>
                    <th class="formTitle">专业承包商：</th>
                    <td class="formValue">
                        <input id="ProfessionalContractor" type="text" class="txt" />
                    </td>
                    <th class="formTitle">
                        负责人：
                    </th>
                    <td class="formValue">
                        <input id="ProfessionalContractorPrincipal" type="text" class="txt" />
                    </td>
                    <th class="formTitle">
                        联系电话：
                    </th>
                    <td class="formValue">
                        <input id="ProfessionalContractorPrincipalTEL" type="text" class="txt" />
                    </td>
                </tr>
                <tr>
                    <th class="formTitle">
                        工程概况：
                    </th>
                    <td class="formValue" colspan="5">
                        <textarea id="Description" name="Description" maxlength="200" class="txtArea" rows="5"></textarea>
                    </td>
                </tr>
            </table>
        </div>
        <div id="div_projcet_logo" style="margin:10px">
            <table class="form">
                <tr>
                    <th class="formTitle">
                        系统标题：
                    </th>
                    <td class="formValue">
                        <input id="ProjectSystemTitel" type="text" class="txt" />
                    </td>
                </tr>
                <tr>
                    <th class="formTitle">
                        系统logo：
                    </th>
                    <td class="formValue" style="height:700px">
                        <img id="project_logo" src="" style="width:100%;height:100%" />
                        @*<input id="ProjectLogo" type="text" class="txt" />*@
                    </td>
                </tr>
            </table>
        </div>
        <div id="div_project_photo" style="margin:10px">
            <p style="font-size:18pt;font-weight:100;text-align:center">项目图片</p>
            <table class="form">
                <tr>
                    <td class="formValue" style="height:700px">
                        <img id="project_background" src="" style="width:100%;height:100%" />
                        @*<input id="ProjectBackground" type="text" class="txt" />*@
                    </td>
                </tr>
            </table>
        </div>

    </div>
</div>
